{"ast":null,"code":"import { arc } from 'd3-shape';\nimport { Path, convertToPath, CSS, PropertySyntax } from '@antv/g';\nimport { isTranspose, isPolar } from '../utils/coordinate';\nimport { getArcObject } from '../shape/utils';\n/**\n * Scale mark from nothing to desired shape in y direction.\n */\nexport const ScaleInY = (options, context) => {\n  // Small enough to hide or show very small part of mark,\n  // but bigger enough to not cause bug.\n  const ZERO = 0.0001;\n  const {\n    coordinate\n  } = context;\n  // the polar coordinate need\n  CSS.registerProperty({\n    name: 'scaleInYRadius',\n    inherits: false,\n    initialValue: '',\n    interpolable: true,\n    syntax: PropertySyntax.NUMBER\n  });\n  return (from, _, defaults) => {\n    const [shape] = from;\n    const PolarScaleInY = shape => {\n      const {\n        __data__,\n        style\n      } = shape;\n      const {\n        radius = 0,\n        inset = 0,\n        fillOpacity = 1,\n        strokeOpacity = 1,\n        opacity = 1\n      } = style;\n      const {\n        points,\n        y,\n        y1\n      } = __data__;\n      const arcObject = getArcObject(coordinate, points, [y, y1]);\n      const {\n        innerRadius,\n        outerRadius\n      } = arcObject;\n      const path = arc().cornerRadius(radius).padAngle(inset * Math.PI / 180);\n      const pathForConversion = new Path({});\n      const createArcPath = arcParams => {\n        pathForConversion.attr({\n          d: path(arcParams)\n        });\n        const convertedPathDefinition = convertToPath(pathForConversion);\n        return convertedPathDefinition;\n      };\n      const keyframes = [{\n        scaleInYRadius: innerRadius + ZERO,\n        fillOpacity: 0,\n        strokeOpacity: 0,\n        opacity: 0\n      }, {\n        scaleInYRadius: innerRadius + ZERO,\n        fillOpacity,\n        strokeOpacity,\n        opacity,\n        offset: 0.01\n      }, {\n        scaleInYRadius: outerRadius,\n        fillOpacity,\n        strokeOpacity,\n        opacity\n      }];\n      const animation = shape.animate(keyframes, Object.assign(Object.assign({}, defaults), options));\n      animation.onframe = function () {\n        shape.style.d = createArcPath(Object.assign(Object.assign({}, arcObject), {\n          outerRadius: Number(shape.style.scaleInYRadius)\n        }));\n      };\n      animation.onfinish = function () {\n        shape.style.d = createArcPath(Object.assign(Object.assign({}, arcObject), {\n          outerRadius: outerRadius\n        }));\n      };\n      return animation;\n    };\n    const RectangularScaleInY = shape => {\n      const {\n        style\n      } = shape;\n      const {\n        transform: prefix = '',\n        fillOpacity = 1,\n        strokeOpacity = 1,\n        opacity = 1\n      } = style;\n      const [transformOrigin, transform] = isTranspose(coordinate) ? [`left top`, `scale(${ZERO}, 1)`] // left-top corner\n      : [`left bottom`, `scale(1, ${ZERO})`]; // left-bottom corner\n      // Using a short fadeIn transition to hide element with scale(0.001)\n      // which is still visible.\n      const keyframes = [{\n        transform: `${prefix} ${transform}`.trimStart(),\n        transformOrigin,\n        fillOpacity: 0,\n        strokeOpacity: 0,\n        opacity: 0\n      }, {\n        transform: `${prefix} ${transform}`.trimStart(),\n        transformOrigin,\n        fillOpacity,\n        strokeOpacity,\n        opacity,\n        offset: 0.01\n      }, {\n        transform: `${prefix} scale(1, 1)`.trimStart(),\n        transformOrigin,\n        fillOpacity,\n        strokeOpacity,\n        opacity\n      }];\n      const animation = shape.animate(keyframes, Object.assign(Object.assign({}, defaults), options));\n      return animation;\n    };\n    if (isPolar(coordinate)) {\n      return PolarScaleInY(shape);\n    } else {\n      return RectangularScaleInY(shape);\n    }\n  };\n};","map":{"version":3,"names":["arc","Path","convertToPath","CSS","PropertySyntax","isTranspose","isPolar","getArcObject","ScaleInY","options","context","ZERO","coordinate","registerProperty","name","inherits","initialValue","interpolable","syntax","NUMBER","from","_","defaults","shape","PolarScaleInY","__data__","style","radius","inset","fillOpacity","strokeOpacity","opacity","points","y","y1","arcObject","innerRadius","outerRadius","path","cornerRadius","padAngle","Math","PI","pathForConversion","createArcPath","arcParams","attr","d","convertedPathDefinition","keyframes","scaleInYRadius","offset","animation","animate","Object","assign","onframe","Number","onfinish","RectangularScaleInY","transform","prefix","transformOrigin","trimStart"],"sources":["animation/scaleInY.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}