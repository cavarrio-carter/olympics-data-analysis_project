{"ast":null,"code":"import { __spreadArray, __read, __assign, __extends } from 'tslib';\nimport { ElementEvent, AABB, CustomEvent, CanvasEvent, Node, Shape, isPattern, GradientType, AbstractRendererPlugin } from '@antv/g-lite';\nimport { isNil, isString } from '@antv/util';\nimport { mat4, vec3 } from 'gl-matrix';\n\n/**\n * support 2 modes in rendering:\n * * immediate\n * * delayed: render at the end of frame with dirty-rectangle\n */\nvar CanvasRendererPlugin = /** @class */function () {\n  function CanvasRendererPlugin(canvasRendererPluginOptions) {\n    this.canvasRendererPluginOptions = canvasRendererPluginOptions;\n    this.removedRBushNodeAABBs = [];\n    this.renderQueue = [];\n    /**\n     * This stack is only used by clipPath for now.\n     */\n    this.restoreStack = [];\n    this.clearFullScreenLastFrame = false;\n    this.clearFullScreen = false;\n    /**\n     * view projection matrix\n     */\n    this.vpMatrix = mat4.create();\n    this.dprMatrix = mat4.create();\n    this.tmpMat4 = mat4.create();\n    this.vec3a = vec3.create();\n    this.vec3b = vec3.create();\n    this.vec3c = vec3.create();\n    this.vec3d = vec3.create();\n  }\n  CanvasRendererPlugin.prototype.apply = function (context, runtime) {\n    var _this = this;\n    this.context = context;\n    var config = context.config,\n      camera = context.camera,\n      renderingService = context.renderingService,\n      renderingContext = context.renderingContext,\n      rBushRoot = context.rBushRoot,\n      // @ts-ignore\n      pathGeneratorFactory = context.pathGeneratorFactory;\n    this.rBush = rBushRoot;\n    this.pathGeneratorFactory = pathGeneratorFactory;\n    var contextService = context.contextService;\n    var canvas = renderingContext.root.ownerDocument.defaultView;\n    var handleUnmounted = function (e) {\n      var object = e.target;\n      // remove r-bush node\n      // @ts-ignore\n      var rBushNode = object.rBushNode;\n      if (rBushNode.aabb) {\n        // save removed aabbs for dirty-rectangle rendering later\n        _this.removedRBushNodeAABBs.push(rBushNode.aabb);\n      }\n    };\n    var handleCulled = function (e) {\n      var object = e.target;\n      // @ts-ignore\n      var rBushNode = object.rBushNode;\n      if (rBushNode.aabb) {\n        // save removed aabbs for dirty-rectangle rendering later\n        _this.removedRBushNodeAABBs.push(rBushNode.aabb);\n      }\n    };\n    renderingService.hooks.init.tap(CanvasRendererPlugin.tag, function () {\n      canvas.addEventListener(ElementEvent.UNMOUNTED, handleUnmounted);\n      canvas.addEventListener(ElementEvent.CULLED, handleCulled);\n      // clear fullscreen\n      var dpr = contextService.getDPR();\n      var width = config.width,\n        height = config.height;\n      var context = contextService.getContext();\n      _this.clearRect(context, 0, 0, width * dpr, height * dpr, config.background);\n    });\n    renderingService.hooks.destroy.tap(CanvasRendererPlugin.tag, function () {\n      canvas.removeEventListener(ElementEvent.UNMOUNTED, handleUnmounted);\n      canvas.removeEventListener(ElementEvent.CULLED, handleCulled);\n      _this.renderQueue = [];\n      _this.removedRBushNodeAABBs = [];\n      _this.restoreStack = [];\n    });\n    renderingService.hooks.beginFrame.tap(CanvasRendererPlugin.tag, function () {\n      var _a;\n      var context = contextService.getContext();\n      var dpr = contextService.getDPR();\n      var width = config.width,\n        height = config.height;\n      var _b = _this.canvasRendererPluginOptions,\n        dirtyObjectNumThreshold = _b.dirtyObjectNumThreshold,\n        dirtyObjectRatioThreshold = _b.dirtyObjectRatioThreshold;\n      // some heuristic conditions such as 80% object changed\n      var _c = renderingService.getStats(),\n        total = _c.total,\n        rendered = _c.rendered;\n      var ratio = rendered / total;\n      _this.clearFullScreen = _this.clearFullScreenLastFrame ||\n      // @ts-ignore\n      !((_a = canvas.context.renderingPlugins[1]) === null || _a === void 0 ? void 0 : _a.isFirstTimeRenderingFinished) || renderingService.disableDirtyRectangleRendering() || rendered > dirtyObjectNumThreshold && ratio > dirtyObjectRatioThreshold;\n      if (context) {\n        context.resetTransform ? context.resetTransform() : context.setTransform(1, 0, 0, 1, 0, 0);\n        if (_this.clearFullScreen) {\n          _this.clearRect(context, 0, 0, width * dpr, height * dpr, config.background);\n        }\n      }\n    });\n    var renderByZIndex = function (object, context) {\n      if (object.isVisible() && !object.isCulled()) {\n        _this.renderDisplayObject(object, context, _this.context, _this.restoreStack, runtime);\n      }\n      var sorted = object.sortable.sorted || object.childNodes;\n      // should account for z-index\n      sorted.forEach(function (child) {\n        renderByZIndex(child, context);\n      });\n    };\n    // render at the end of frame\n    renderingService.hooks.endFrame.tap(CanvasRendererPlugin.tag, function () {\n      // Skip rendering.\n      if (renderingContext.root.childNodes.length === 0) {\n        _this.clearFullScreenLastFrame = true;\n        return;\n      }\n      _this.clearFullScreenLastFrame = false;\n      var context = contextService.getContext();\n      // clear & clip dirty rectangle\n      var dpr = contextService.getDPR();\n      mat4.fromScaling(_this.dprMatrix, [dpr, dpr, 1]);\n      mat4.multiply(_this.vpMatrix, _this.dprMatrix, camera.getOrthoMatrix());\n      if (_this.clearFullScreen) {\n        // console.log('canvas renderer fcp...', renderingContext.root.childNodes);\n        renderByZIndex(renderingContext.root, context);\n      } else {\n        // console.log('canvas renderer next...', this.renderQueue);\n        // merge removed AABB\n        var dirtyRenderBounds = _this.safeMergeAABB.apply(_this, __spreadArray([_this.mergeDirtyAABBs(_this.renderQueue)], __read(_this.removedRBushNodeAABBs.map(function (_a) {\n          var minX = _a.minX,\n            minY = _a.minY,\n            maxX = _a.maxX,\n            maxY = _a.maxY;\n          var aabb = new AABB();\n          aabb.setMinMax(\n          // vec3.fromValues(minX, minY, 0),\n          // vec3.fromValues(maxX, maxY, 0),\n          [minX, minY, 0], [maxX, maxY, 0]);\n          return aabb;\n        })), false));\n        _this.removedRBushNodeAABBs = [];\n        if (AABB.isEmpty(dirtyRenderBounds)) {\n          _this.renderQueue = [];\n          return;\n        }\n        var dirtyRect = _this.convertAABB2Rect(dirtyRenderBounds);\n        var x = dirtyRect.x,\n          y = dirtyRect.y,\n          width = dirtyRect.width,\n          height = dirtyRect.height;\n        var tl = vec3.transformMat4(_this.vec3a, [x, y, 0], _this.vpMatrix);\n        var tr = vec3.transformMat4(_this.vec3b, [x + width, y, 0], _this.vpMatrix);\n        var bl = vec3.transformMat4(_this.vec3c, [x, y + height, 0], _this.vpMatrix);\n        var br = vec3.transformMat4(_this.vec3d, [x + width, y + height, 0], _this.vpMatrix);\n        var minx = Math.min(tl[0], tr[0], br[0], bl[0]);\n        var miny = Math.min(tl[1], tr[1], br[1], bl[1]);\n        var maxx = Math.max(tl[0], tr[0], br[0], bl[0]);\n        var maxy = Math.max(tl[1], tr[1], br[1], bl[1]);\n        var ix = Math.floor(minx);\n        var iy = Math.floor(miny);\n        var iwidth = Math.ceil(maxx - minx);\n        var iheight = Math.ceil(maxy - miny);\n        context.save();\n        _this.clearRect(context, ix, iy, iwidth, iheight, config.background);\n        context.beginPath();\n        context.rect(ix, iy, iwidth, iheight);\n        context.clip();\n        // @see https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Transformations\n        context.setTransform(_this.vpMatrix[0], _this.vpMatrix[1], _this.vpMatrix[4], _this.vpMatrix[5], _this.vpMatrix[12], _this.vpMatrix[13]);\n        // draw dirty rectangle\n        var enableDirtyRectangleRenderingDebug = config.renderer.getConfig().enableDirtyRectangleRenderingDebug;\n        if (enableDirtyRectangleRenderingDebug) {\n          canvas.dispatchEvent(new CustomEvent(CanvasEvent.DIRTY_RECTANGLE, {\n            dirtyRect: {\n              x: ix,\n              y: iy,\n              width: iwidth,\n              height: iheight\n            }\n          }));\n        }\n        // search objects intersect with dirty rectangle\n        var dirtyObjects = _this.searchDirtyObjects(dirtyRenderBounds);\n        // do rendering\n        dirtyObjects\n        // sort by z-index\n        .sort(function (a, b) {\n          return a.sortable.renderOrder - b.sortable.renderOrder;\n        }).forEach(function (object) {\n          // culled object should not be rendered\n          if (object && object.isVisible() && !object.isCulled()) {\n            _this.renderDisplayObject(object, context, _this.context, _this.restoreStack, runtime);\n          }\n        });\n        context.restore();\n        // save dirty AABBs in last frame\n        _this.renderQueue.forEach(function (object) {\n          _this.saveDirtyAABB(object);\n        });\n        // clear queue\n        _this.renderQueue = [];\n      }\n      // pop restore stack, eg. root -> parent -> child\n      _this.restoreStack.forEach(function () {\n        context.restore();\n      });\n      // clear restore stack\n      _this.restoreStack = [];\n    });\n    renderingService.hooks.render.tap(CanvasRendererPlugin.tag, function (object) {\n      if (!_this.clearFullScreen) {\n        // render at the end of frame\n        _this.renderQueue.push(object);\n      }\n    });\n  };\n  CanvasRendererPlugin.prototype.clearRect = function (context, x, y, width, height, background) {\n    // clearRect is faster than fillRect @see https://stackoverflow.com/a/30830253\n    context.clearRect(x, y, width, height);\n    if (background) {\n      context.fillStyle = background;\n      context.fillRect(x, y, width, height);\n    }\n  };\n  CanvasRendererPlugin.prototype.renderDisplayObject = function (object, context, canvasContext, restoreStack, runtime) {\n    var nodeName = object.nodeName;\n    // console.log('canvas render:', object);\n    // restore to its ancestor\n    var parent = restoreStack[restoreStack.length - 1];\n    if (parent && !(object.compareDocumentPosition(parent) & Node.DOCUMENT_POSITION_CONTAINS)) {\n      context.restore();\n      restoreStack.pop();\n    }\n    // @ts-ignore\n    var styleRenderer = this.context.styleRendererFactory[nodeName];\n    var generatePath = this.pathGeneratorFactory[nodeName];\n    // clip path\n    var clipPath = object.parsedStyle.clipPath;\n    if (clipPath) {\n      this.applyWorldTransform(context, clipPath);\n      // generate path in local space\n      var generatePath_1 = this.pathGeneratorFactory[clipPath.nodeName];\n      if (generatePath_1) {\n        context.save();\n        // save clip\n        restoreStack.push(object);\n        context.beginPath();\n        generatePath_1(context, clipPath.parsedStyle);\n        context.closePath();\n        context.clip();\n      }\n    }\n    // fill & stroke\n    if (styleRenderer) {\n      this.applyWorldTransform(context, object);\n      context.save();\n      // apply attributes to context\n      this.applyAttributesToContext(context, object);\n    }\n    if (generatePath) {\n      context.beginPath();\n      generatePath(context, object.parsedStyle);\n      if (object.nodeName !== Shape.LINE && object.nodeName !== Shape.PATH && object.nodeName !== Shape.POLYLINE) {\n        context.closePath();\n      }\n    }\n    // fill & stroke\n    if (styleRenderer) {\n      styleRenderer.render(context, object.parsedStyle, object, canvasContext, this, runtime);\n      // restore applied attributes, eg. shadowBlur shadowColor...\n      context.restore();\n    }\n    // finish rendering, clear dirty flag\n    object.renderable.dirty = false;\n  };\n  CanvasRendererPlugin.prototype.convertAABB2Rect = function (aabb) {\n    var min = aabb.getMin();\n    var max = aabb.getMax();\n    // expand the rectangle a bit to avoid artifacts\n    // @see https://www.yuque.com/antv/ou292n/bi8nix#ExvCu\n    var minX = Math.floor(min[0]);\n    var minY = Math.floor(min[1]);\n    var maxX = Math.ceil(max[0]);\n    var maxY = Math.ceil(max[1]);\n    var width = maxX - minX;\n    var height = maxY - minY;\n    return {\n      x: minX,\n      y: minY,\n      width: width,\n      height: height\n    };\n  };\n  /**\n   * TODO: merge dirty rectangles with some strategies.\n   * For now, we just simply merge all the rectangles into one.\n   * @see https://idom.me/articles/841.html\n   */\n  CanvasRendererPlugin.prototype.mergeDirtyAABBs = function (dirtyObjects) {\n    // merge into a big AABB\n    // TODO: skip descendant if ancestor is caculated, but compareNodePosition is really slow\n    var aabb = new AABB();\n    dirtyObjects.forEach(function (object) {\n      var renderBounds = object.getRenderBounds();\n      aabb.add(renderBounds);\n      var dirtyRenderBounds = object.renderable.dirtyRenderBounds;\n      if (dirtyRenderBounds) {\n        aabb.add(dirtyRenderBounds);\n      }\n    });\n    return aabb;\n  };\n  CanvasRendererPlugin.prototype.searchDirtyObjects = function (dirtyRectangle) {\n    // search in r-tree, get all affected nodes\n    var _a = __read(dirtyRectangle.getMin(), 2),\n      minX = _a[0],\n      minY = _a[1];\n    var _b = __read(dirtyRectangle.getMax(), 2),\n      maxX = _b[0],\n      maxY = _b[1];\n    var rBushNodes = this.rBush.search({\n      minX: minX,\n      minY: minY,\n      maxX: maxX,\n      maxY: maxY\n    });\n    return rBushNodes.map(function (_a) {\n      var displayObject = _a.displayObject;\n      return displayObject;\n    });\n  };\n  CanvasRendererPlugin.prototype.saveDirtyAABB = function (object) {\n    var renderable = object.renderable;\n    if (!renderable.dirtyRenderBounds) {\n      renderable.dirtyRenderBounds = new AABB();\n    }\n    var renderBounds = object.getRenderBounds();\n    if (renderBounds) {\n      // save last dirty aabb\n      renderable.dirtyRenderBounds.update(renderBounds.center, renderBounds.halfExtents);\n    }\n  };\n  /**\n   * TODO: batch the same global attributes\n   */\n  CanvasRendererPlugin.prototype.applyAttributesToContext = function (context, object) {\n    var _a = object.parsedStyle,\n      stroke = _a.stroke,\n      fill = _a.fill,\n      opacity = _a.opacity,\n      lineDash = _a.lineDash,\n      lineDashOffset = _a.lineDashOffset;\n    // @see https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/setLineDash\n    if (lineDash) {\n      context.setLineDash(lineDash);\n    }\n    // @see https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/lineDashOffset\n    if (!isNil(lineDashOffset)) {\n      context.lineDashOffset = lineDashOffset;\n    }\n    if (!isNil(opacity)) {\n      context.globalAlpha *= opacity;\n    }\n    if (!isNil(stroke) && !Array.isArray(stroke) && !stroke.isNone) {\n      context.strokeStyle = object.attributes.stroke;\n    }\n    if (!isNil(fill) && !Array.isArray(fill) && !fill.isNone) {\n      context.fillStyle = object.attributes.fill;\n    }\n  };\n  CanvasRendererPlugin.prototype.applyWorldTransform = function (context, object, matrix) {\n    // apply clip shape's RTS\n    if (matrix) {\n      mat4.copy(this.tmpMat4, object.getLocalTransform());\n      mat4.multiply(this.tmpMat4, matrix, this.tmpMat4);\n      mat4.multiply(this.tmpMat4, this.vpMatrix, this.tmpMat4);\n    } else {\n      // apply RTS transformation in world space\n      mat4.copy(this.tmpMat4, object.getWorldTransform());\n      mat4.multiply(this.tmpMat4, this.vpMatrix, this.tmpMat4);\n    }\n    // @see https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Transformations\n    context.setTransform(this.tmpMat4[0], this.tmpMat4[1], this.tmpMat4[4], this.tmpMat4[5], this.tmpMat4[12], this.tmpMat4[13]);\n  };\n  CanvasRendererPlugin.prototype.safeMergeAABB = function () {\n    var aabbs = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n      aabbs[_i] = arguments[_i];\n    }\n    var merged = new AABB();\n    aabbs.forEach(function (aabb) {\n      merged.add(aabb);\n    });\n    return merged;\n  };\n  CanvasRendererPlugin.tag = 'CanvasRenderer';\n  return CanvasRendererPlugin;\n}();\nvar DefaultRenderer = /** @class */function () {\n  function DefaultRenderer(imagePool) {\n    this.imagePool = imagePool;\n  }\n  DefaultRenderer.prototype.render = function (context, parsedStyle, object, canvasContext, plugin, runtime) {\n    var fill = parsedStyle.fill,\n      fillRule = parsedStyle.fillRule,\n      _a = parsedStyle.opacity,\n      opacity = _a === void 0 ? 1 : _a,\n      _b = parsedStyle.fillOpacity,\n      fillOpacity = _b === void 0 ? 1 : _b,\n      stroke = parsedStyle.stroke,\n      _c = parsedStyle.strokeOpacity,\n      strokeOpacity = _c === void 0 ? 1 : _c,\n      _d = parsedStyle.lineWidth,\n      lineWidth = _d === void 0 ? 1 : _d,\n      lineCap = parsedStyle.lineCap,\n      lineJoin = parsedStyle.lineJoin,\n      shadowType = parsedStyle.shadowType,\n      shadowColor = parsedStyle.shadowColor,\n      shadowBlur = parsedStyle.shadowBlur,\n      filter = parsedStyle.filter,\n      miterLimit = parsedStyle.miterLimit;\n    var hasFill = fill && !fill.isNone;\n    var hasStroke = stroke && !stroke.isNone && lineWidth > 0;\n    var isFillTransparent = (fill === null || fill === void 0 ? void 0 : fill.alpha) === 0;\n    var hasFilter = !!(filter && filter.length);\n    var hasShadow = !isNil(shadowColor) && shadowBlur > 0;\n    var nodeName = object.nodeName;\n    var isInnerShadow = shadowType === 'inner';\n    var shouldDrawShadowWithStroke = hasStroke && hasShadow && (nodeName === Shape.PATH || nodeName === Shape.LINE || nodeName === Shape.POLYLINE || isFillTransparent || isInnerShadow);\n    if (hasFill) {\n      context.globalAlpha = opacity * fillOpacity;\n      if (!shouldDrawShadowWithStroke) {\n        setShadowAndFilter(object, context, hasShadow);\n      }\n      applyFill(context, object, fill, fillRule, canvasContext, plugin, runtime, this.imagePool);\n      if (!shouldDrawShadowWithStroke) {\n        this.clearShadowAndFilter(context, hasFilter, hasShadow);\n      }\n    }\n    if (hasStroke) {\n      context.globalAlpha = opacity * strokeOpacity;\n      context.lineWidth = lineWidth;\n      if (!isNil(miterLimit)) {\n        context.miterLimit = miterLimit;\n      }\n      if (!isNil(lineCap)) {\n        context.lineCap = lineCap;\n      }\n      if (!isNil(lineJoin)) {\n        context.lineJoin = lineJoin;\n      }\n      if (shouldDrawShadowWithStroke) {\n        if (isInnerShadow) {\n          context.globalCompositeOperation = 'source-atop';\n        }\n        setShadowAndFilter(object, context, true);\n        if (isInnerShadow) {\n          applyStroke(context, object, stroke, canvasContext, plugin, runtime, this.imagePool);\n          context.globalCompositeOperation = 'source-over';\n          this.clearShadowAndFilter(context, hasFilter, true);\n        }\n      }\n      applyStroke(context, object, stroke, canvasContext, plugin, runtime, this.imagePool);\n    }\n  };\n  DefaultRenderer.prototype.clearShadowAndFilter = function (context, hasFilter, hasShadow) {\n    if (hasShadow) {\n      context.shadowColor = 'transparent';\n      context.shadowBlur = 0;\n    }\n    if (hasFilter) {\n      // save drop-shadow filter\n      var oldFilter = context.filter;\n      if (!isNil(oldFilter) && oldFilter.indexOf('drop-shadow') > -1) {\n        context.filter = oldFilter.replace(/drop-shadow\\([^)]*\\)/, '').trim() || 'none';\n      }\n    }\n  };\n  return DefaultRenderer;\n}();\n/**\n * apply before fill and stroke but only once\n */\nfunction setShadowAndFilter(object, context, hasShadow) {\n  var _a = object.parsedStyle,\n    filter = _a.filter,\n    shadowColor = _a.shadowColor,\n    shadowBlur = _a.shadowBlur,\n    shadowOffsetX = _a.shadowOffsetX,\n    shadowOffsetY = _a.shadowOffsetY;\n  if (filter && filter.length) {\n    // use raw filter string\n    context.filter = object.style.filter;\n  }\n  if (hasShadow) {\n    context.shadowColor = shadowColor.toString();\n    context.shadowBlur = shadowBlur || 0;\n    context.shadowOffsetX = shadowOffsetX || 0;\n    context.shadowOffsetY = shadowOffsetY || 0;\n  }\n}\nfunction getPattern(pattern, object, context, canvasContext, plugin, runtime, imagePool) {\n  var $offscreenCanvas;\n  var dpr;\n  if (pattern.image.nodeName === 'rect') {\n    var _a = pattern.image.parsedStyle,\n      width = _a.width,\n      height = _a.height;\n    dpr = canvasContext.contextService.getDPR();\n    var offscreenCanvas = canvasContext.config.offscreenCanvas;\n    $offscreenCanvas = runtime.offscreenCanvasCreator.getOrCreateCanvas(offscreenCanvas);\n    $offscreenCanvas.width = width * dpr;\n    $offscreenCanvas.height = height * dpr;\n    var offscreenCanvasContext_1 = runtime.offscreenCanvasCreator.getOrCreateContext(offscreenCanvas);\n    var restoreStack_1 = [];\n    // offscreenCanvasContext.scale(1 / dpr, 1 / dpr);\n    pattern.image.forEach(function (object) {\n      plugin.renderDisplayObject(object, offscreenCanvasContext_1, canvasContext, restoreStack_1, runtime);\n    });\n    restoreStack_1.forEach(function () {\n      offscreenCanvasContext_1.restore();\n    });\n  }\n  var canvasPattern = imagePool.getOrCreatePatternSync(pattern, context, $offscreenCanvas, dpr, object.getGeometryBounds().min, function () {\n    // set dirty rectangle flag\n    object.renderable.dirty = true;\n    canvasContext.renderingService.dirtify();\n  });\n  return canvasPattern;\n}\nfunction getColor(parsedColor, object, context, imagePool) {\n  var color;\n  if (parsedColor.type === GradientType.LinearGradient || parsedColor.type === GradientType.RadialGradient) {\n    var bounds = object.getGeometryBounds();\n    var width = bounds && bounds.halfExtents[0] * 2 || 1;\n    var height = bounds && bounds.halfExtents[1] * 2 || 1;\n    var min = bounds && bounds.min || [0, 0];\n    color = imagePool.getOrCreateGradient(__assign(__assign({\n      type: parsedColor.type\n    }, parsedColor.value), {\n      min: min,\n      width: width,\n      height: height\n    }), context);\n  }\n  return color;\n}\nfunction applyFill(context, object, fill, fillRule, canvasContext, plugin, runtime, imagePool, skipFill) {\n  if (skipFill === void 0) {\n    skipFill = false;\n  }\n  if (Array.isArray(fill)) {\n    fill.forEach(function (gradient) {\n      context.fillStyle = getColor(gradient, object, context, imagePool);\n      if (!skipFill) {\n        fillRule ? context.fill(fillRule) : context.fill();\n      }\n    });\n  } else {\n    if (isPattern(fill)) {\n      context.fillStyle = getPattern(fill, object, context, canvasContext, plugin, runtime, imagePool);\n    }\n    if (!skipFill) {\n      fillRule ? context.fill(fillRule) : context.fill();\n    }\n  }\n}\nfunction applyStroke(context, object, stroke, canvasContext, plugin, runtime, imagePool, skipStroke) {\n  if (skipStroke === void 0) {\n    skipStroke = false;\n  }\n  if (Array.isArray(stroke)) {\n    stroke.forEach(function (gradient) {\n      context.strokeStyle = getColor(gradient, object, context, imagePool);\n      if (!skipStroke) {\n        context.stroke();\n      }\n    });\n  } else {\n    if (isPattern(stroke)) {\n      context.strokeStyle = getPattern(stroke, object, context, canvasContext, plugin, runtime, imagePool);\n    }\n    if (!skipStroke) {\n      context.stroke();\n    }\n  }\n}\nvar ImageRenderer = /** @class */function () {\n  function ImageRenderer(imagePool) {\n    this.imagePool = imagePool;\n  }\n  ImageRenderer.prototype.render = function (context, parsedStyle, object) {\n    var _a = parsedStyle.x,\n      x = _a === void 0 ? 0 : _a,\n      _b = parsedStyle.y,\n      y = _b === void 0 ? 0 : _b,\n      width = parsedStyle.width,\n      height = parsedStyle.height,\n      src = parsedStyle.src,\n      shadowColor = parsedStyle.shadowColor,\n      shadowBlur = parsedStyle.shadowBlur;\n    var image;\n    var iw = width;\n    var ih = height;\n    if (isString(src)) {\n      // image has been loaded in `mounted` hook\n      image = this.imagePool.getImageSync(src);\n    } else {\n      iw || (iw = src.width);\n      ih || (ih = src.height);\n      image = src;\n    }\n    if (image) {\n      var hasShadow = !isNil(shadowColor) && shadowBlur > 0;\n      setShadowAndFilter(object, context, hasShadow);\n      // node-canvas will throw the following err:\n      // Error: Image given has not completed loading\n      try {\n        context.drawImage(image, x, y, iw, ih);\n      } catch (e) {}\n    }\n  };\n  return ImageRenderer;\n}();\nvar TextRenderer = /** @class */function () {\n  function TextRenderer(imagePool) {\n    this.imagePool = imagePool;\n  }\n  TextRenderer.prototype.render = function (context, parsedStyle, object, canvasContext, plugin, runtime) {\n    // Trigger text geometry calculation.\n    object.getBounds();\n    var _a = parsedStyle,\n      _b = _a.lineWidth,\n      lineWidth = _b === void 0 ? 1 : _b,\n      _c = _a.textAlign,\n      textAlign = _c === void 0 ? 'start' : _c,\n      _d = _a.textBaseline,\n      textBaseline = _d === void 0 ? 'alphabetic' : _d,\n      _e = _a.lineJoin,\n      lineJoin = _e === void 0 ? 'miter' : _e,\n      _f = _a.miterLimit,\n      miterLimit = _f === void 0 ? 10 : _f,\n      _g = _a.letterSpacing,\n      letterSpacing = _g === void 0 ? 0 : _g,\n      stroke = _a.stroke,\n      fill = _a.fill,\n      fillRule = _a.fillRule,\n      _h = _a.fillOpacity,\n      fillOpacity = _h === void 0 ? 1 : _h,\n      _j = _a.strokeOpacity,\n      strokeOpacity = _j === void 0 ? 1 : _j,\n      _k = _a.opacity,\n      opacity = _k === void 0 ? 1 : _k,\n      metrics = _a.metrics,\n      _l = _a.x,\n      x = _l === void 0 ? 0 : _l,\n      _m = _a.y,\n      y = _m === void 0 ? 0 : _m,\n      dx = _a.dx,\n      dy = _a.dy,\n      shadowColor = _a.shadowColor,\n      shadowBlur = _a.shadowBlur;\n    var font = metrics.font,\n      lines = metrics.lines,\n      height = metrics.height,\n      lineHeight = metrics.lineHeight,\n      lineMetrics = metrics.lineMetrics;\n    context.font = font;\n    context.lineWidth = lineWidth;\n    context.textAlign = textAlign === 'middle' ? 'center' : textAlign;\n    var formattedTextBaseline = textBaseline;\n    if (\n    // formattedTextBaseline === 'bottom' ||\n    !runtime.enableCSSParsing && formattedTextBaseline === 'alphabetic') {\n      formattedTextBaseline = 'bottom';\n    }\n    context.lineJoin = lineJoin;\n    if (!isNil(miterLimit)) {\n      context.miterLimit = miterLimit;\n    }\n    var linePositionY = y;\n    // handle vertical text baseline\n    if (textBaseline === 'middle') {\n      linePositionY += -height / 2 - lineHeight / 2;\n    } else if (textBaseline === 'bottom' || textBaseline === 'alphabetic' || textBaseline === 'ideographic') {\n      linePositionY += -height;\n    } else if (textBaseline === 'top' || textBaseline === 'hanging') {\n      linePositionY += -lineHeight;\n    }\n    // account for dx & dy\n    var offsetX = x + (dx || 0);\n    linePositionY += dy || 0;\n    if (lines.length === 1) {\n      if (formattedTextBaseline === 'bottom') {\n        formattedTextBaseline = 'middle';\n        linePositionY -= 0.5 * height;\n      } else if (formattedTextBaseline === 'top') {\n        formattedTextBaseline = 'middle';\n        linePositionY += 0.5 * height;\n      }\n    }\n    context.textBaseline = formattedTextBaseline;\n    var hasShadow = !isNil(shadowColor) && shadowBlur > 0;\n    setShadowAndFilter(object, context, hasShadow);\n    // draw lines line by line\n    for (var i = 0; i < lines.length; i++) {\n      var linePositionX = lineWidth / 2 + offsetX;\n      linePositionY += lineHeight;\n      // no need to re-position X, cause we already set text align\n      // @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/textAlign\n      if (!isNil(stroke) && !stroke.isNone && lineWidth) {\n        this.drawLetterSpacing(context, object, lines[i], lineMetrics[i], textAlign, linePositionX, linePositionY, letterSpacing, fill, fillRule, fillOpacity, stroke, strokeOpacity, opacity, true, canvasContext, plugin, runtime);\n      }\n      if (!isNil(fill)) {\n        this.drawLetterSpacing(context, object, lines[i], lineMetrics[i], textAlign, linePositionX, linePositionY, letterSpacing, fill, fillRule, fillOpacity, stroke, strokeOpacity, opacity, false, canvasContext, plugin, runtime);\n      }\n    }\n  };\n  TextRenderer.prototype.drawLetterSpacing = function (context, object, text, lineMetrics, textAlign, x, y, letterSpacing, fill, fillRule, fillOpacity, stroke, strokeOpacity, opacity, isStroke, canvasContext, plugin, runtime) {\n    // letterSpacing of 0 means normal, render all texts directly\n    if (letterSpacing === 0) {\n      if (isStroke) {\n        this.strokeText(context, object, text, x, y, stroke, strokeOpacity, canvasContext, plugin, runtime);\n      } else {\n        this.fillText(context, object, text, x, y, fill, fillRule, fillOpacity, opacity, canvasContext, plugin, runtime);\n      }\n      return;\n    }\n    // draw text using left align\n    var currentTextAlign = context.textAlign;\n    context.textAlign = 'left';\n    var currentPosition = x;\n    if (textAlign === 'center' || textAlign === 'middle') {\n      currentPosition = x - lineMetrics.width / 2;\n    } else if (textAlign === 'right' || textAlign === 'end') {\n      currentPosition = x - lineMetrics.width;\n    }\n    var stringArray = Array.from(text);\n    var previousWidth = context.measureText(text).width;\n    var currentWidth = 0;\n    for (var i = 0; i < stringArray.length; ++i) {\n      var currentChar = stringArray[i];\n      if (isStroke) {\n        this.strokeText(context, object, currentChar, currentPosition, y, stroke, strokeOpacity, canvasContext, plugin, runtime);\n      } else {\n        this.fillText(context, object, currentChar, currentPosition, y, fill, fillRule, fillOpacity, opacity, canvasContext, plugin, runtime);\n      }\n      currentWidth = context.measureText(text.substring(i + 1)).width;\n      currentPosition += previousWidth - currentWidth + letterSpacing;\n      previousWidth = currentWidth;\n    }\n    context.textAlign = currentTextAlign;\n  };\n  TextRenderer.prototype.fillText = function (context, object, text, x, y, fill, fillRule, fillOpacity, opacity, canvasContext, plugin, runtime) {\n    applyFill(context, object, fill, fillRule, canvasContext, plugin, runtime, this.imagePool, true);\n    var currentGlobalAlpha;\n    var applyOpacity = !isNil(fillOpacity) && fillOpacity !== 1;\n    if (applyOpacity) {\n      currentGlobalAlpha = context.globalAlpha;\n      context.globalAlpha = fillOpacity * opacity;\n    }\n    context.fillText(text, x, y);\n    if (applyOpacity) {\n      context.globalAlpha = currentGlobalAlpha;\n    }\n  };\n  TextRenderer.prototype.strokeText = function (context, object, text, x, y, stroke, strokeOpacity, canvasContext, plugin, runtime) {\n    applyStroke(context, object, stroke, canvasContext, plugin, runtime, this.imagePool, true);\n    var currentGlobalAlpha;\n    var applyOpacity = !isNil(strokeOpacity) && strokeOpacity !== 1;\n    if (applyOpacity) {\n      currentGlobalAlpha = context.globalAlpha;\n      context.globalAlpha = strokeOpacity;\n    }\n    context.strokeText(text, x, y);\n    if (applyOpacity) {\n      context.globalAlpha = currentGlobalAlpha;\n    }\n  };\n  return TextRenderer;\n}();\nvar RectRenderer = /** @class */function (_super) {\n  __extends(RectRenderer, _super);\n  function RectRenderer() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  return RectRenderer;\n}(DefaultRenderer);\nvar CircleRenderer = /** @class */function (_super) {\n  __extends(CircleRenderer, _super);\n  function CircleRenderer() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  return CircleRenderer;\n}(DefaultRenderer);\nvar EllipseRenderer = /** @class */function (_super) {\n  __extends(EllipseRenderer, _super);\n  function EllipseRenderer() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  return EllipseRenderer;\n}(DefaultRenderer);\nvar LineRenderer = /** @class */function (_super) {\n  __extends(LineRenderer, _super);\n  function LineRenderer() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  return LineRenderer;\n}(DefaultRenderer);\nvar PolylineRenderer = /** @class */function (_super) {\n  __extends(PolylineRenderer, _super);\n  function PolylineRenderer() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  return PolylineRenderer;\n}(DefaultRenderer);\nvar PolygonRenderer = /** @class */function (_super) {\n  __extends(PolygonRenderer, _super);\n  function PolygonRenderer() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  return PolygonRenderer;\n}(DefaultRenderer);\nvar PathRenderer = /** @class */function (_super) {\n  __extends(PathRenderer, _super);\n  function PathRenderer() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  return PathRenderer;\n}(DefaultRenderer);\nvar Plugin = /** @class */function (_super) {\n  __extends(Plugin, _super);\n  function Plugin(options) {\n    if (options === void 0) {\n      options = {};\n    }\n    var _this = _super.call(this) || this;\n    _this.options = options;\n    _this.name = 'canvas-renderer';\n    return _this;\n  }\n  Plugin.prototype.init = function () {\n    var _a;\n    var canvasRendererPluginOptions = __assign({\n      dirtyObjectNumThreshold: 500,\n      dirtyObjectRatioThreshold: 0.8\n    }, this.options);\n    // @ts-ignore\n    var imagePool = this.context.imagePool;\n    var defaultRenderer = new DefaultRenderer(imagePool);\n    var defaultStyleRendererFactory = (_a = {}, _a[Shape.CIRCLE] = defaultRenderer, _a[Shape.ELLIPSE] = defaultRenderer, _a[Shape.RECT] = defaultRenderer, _a[Shape.IMAGE] = new ImageRenderer(imagePool), _a[Shape.TEXT] = new TextRenderer(imagePool), _a[Shape.LINE] = defaultRenderer, _a[Shape.POLYLINE] = defaultRenderer, _a[Shape.POLYGON] = defaultRenderer, _a[Shape.PATH] = defaultRenderer, _a[Shape.GROUP] = undefined, _a[Shape.HTML] = undefined, _a[Shape.MESH] = undefined, _a);\n    this.context.defaultStyleRendererFactory = defaultStyleRendererFactory;\n    this.context.styleRendererFactory = defaultStyleRendererFactory;\n    this.addRenderingPlugin(new CanvasRendererPlugin(canvasRendererPluginOptions));\n  };\n  Plugin.prototype.destroy = function () {\n    this.removeAllRenderingPlugins();\n    delete this.context.defaultStyleRendererFactory;\n    delete this.context.styleRendererFactory;\n  };\n  return Plugin;\n}(AbstractRendererPlugin);\nexport { CircleRenderer, EllipseRenderer, ImageRenderer, LineRenderer, PathRenderer, Plugin, PolygonRenderer, PolylineRenderer, RectRenderer, TextRenderer };","map":{"version":3,"names":["CanvasRendererPlugin","canvasRendererPluginOptions","removedRBushNodeAABBs","renderQueue","restoreStack","clearFullScreenLastFrame","clearFullScreen","vpMatrix","mat4","create","dprMatrix","tmpMat4","vec3a","vec3","vec3b","vec3c","vec3d","prototype","apply","context","runtime","_this","config","camera","renderingService","renderingContext","rBushRoot","pathGeneratorFactory","rBush","contextService","canvas","root","ownerDocument","defaultView","handleUnmounted","e","object","target","rBushNode","aabb","push","handleCulled","hooks","init","tap","tag","addEventListener","ElementEvent","UNMOUNTED","CULLED","dpr","getDPR","width","height","getContext","clearRect","background","destroy","removeEventListener","beginFrame","_b","dirtyObjectNumThreshold","dirtyObjectRatioThreshold","_c","getStats","total","rendered","ratio","_a","renderingPlugins","isFirstTimeRenderingFinished","disableDirtyRectangleRendering","resetTransform","setTransform","renderByZIndex","isVisible","isCulled","renderDisplayObject","sorted","sortable","childNodes","forEach","child","endFrame","length","fromScaling","multiply","getOrthoMatrix","dirtyRenderBounds","safeMergeAABB","__spreadArray","mergeDirtyAABBs","__read","map","minX","minY","maxX","maxY","AABB","setMinMax","isEmpty","dirtyRect","convertAABB2Rect","x","y","tl","transformMat4","tr","bl","br","minx","Math","min","miny","maxx","max","maxy","ix","floor","iy","iwidth","ceil","iheight","save","beginPath","rect","clip","enableDirtyRectangleRenderingDebug","renderer","getConfig","dispatchEvent","CustomEvent","CanvasEvent","DIRTY_RECTANGLE","dirtyObjects","searchDirtyObjects","sort","a","b","renderOrder","restore","saveDirtyAABB","render","fillStyle","fillRect","canvasContext","nodeName","parent","compareDocumentPosition","Node","DOCUMENT_POSITION_CONTAINS","pop","styleRenderer","styleRendererFactory","generatePath","clipPath","parsedStyle","applyWorldTransform","generatePath_1","closePath","applyAttributesToContext","Shape","LINE","PATH","POLYLINE","renderable","dirty","getMin","getMax","renderBounds","getRenderBounds","add","dirtyRectangle","rBushNodes","search","displayObject","update","center","halfExtents","stroke","fill","opacity","lineDash","lineDashOffset","setLineDash","isNil","globalAlpha","Array","isArray","isNone","strokeStyle","attributes","matrix","copy","getLocalTransform","getWorldTransform","aabbs","_i","arguments","merged","DefaultRenderer","imagePool","plugin","fillRule","fillOpacity","strokeOpacity","_d","lineWidth","lineCap","lineJoin","shadowType","shadowColor","shadowBlur","filter","miterLimit","hasFill","hasStroke","isFillTransparent","alpha","hasFilter","hasShadow","isInnerShadow","shouldDrawShadowWithStroke","setShadowAndFilter","applyFill","clearShadowAndFilter","globalCompositeOperation","applyStroke","oldFilter","indexOf","replace","trim","shadowOffsetX","shadowOffsetY","style","toString","getPattern","pattern","$offscreenCanvas","image","offscreenCanvas","offscreenCanvasCreator","getOrCreateCanvas","offscreenCanvasContext_1","getOrCreateContext","restoreStack_1","canvasPattern","getOrCreatePatternSync","getGeometryBounds","dirtify","getColor","parsedColor","color","type","GradientType","LinearGradient","RadialGradient","bounds","getOrCreateGradient","__assign","value","skipFill","gradient","isPattern","skipStroke","ImageRenderer","src","iw","ih","isString","getImageSync","drawImage","TextRenderer","getBounds","textAlign","textBaseline","_e","_f","_g","letterSpacing","_h","_j","_k","metrics","_l","_m","dx","dy","font","lines","lineHeight","lineMetrics","formattedTextBaseline","enableCSSParsing","linePositionY","offsetX","i","linePositionX","drawLetterSpacing","text","isStroke","strokeText","fillText","currentTextAlign","currentPosition","stringArray","from","previousWidth","measureText","currentWidth","currentChar","substring","currentGlobalAlpha","applyOpacity","RectRenderer","_super","__extends","CircleRenderer","EllipseRenderer","LineRenderer","PolylineRenderer","PolygonRenderer","PathRenderer","Plugin","options","call","name","defaultRenderer","defaultStyleRendererFactory","CIRCLE","ELLIPSE","RECT","IMAGE","TEXT","POLYGON","GROUP","undefined","HTML","MESH","addRenderingPlugin","removeAllRenderingPlugins","AbstractRendererPlugin"],"sources":["../src/packages/g-plugin-canvas-renderer/src/CanvasRendererPlugin.ts","../src/packages/g-plugin-canvas-renderer/src/shapes/styles/Default.ts","../src/packages/g-plugin-canvas-renderer/src/shapes/styles/Image.ts","../src/packages/g-plugin-canvas-renderer/src/shapes/styles/Text.ts","../src/packages/g-plugin-canvas-renderer/src/shapes/styles/Rect.ts","../src/packages/g-plugin-canvas-renderer/src/shapes/styles/Circle.ts","../src/packages/g-plugin-canvas-renderer/src/shapes/styles/Ellipse.ts","../src/packages/g-plugin-canvas-renderer/src/shapes/styles/Line.ts","../src/packages/g-plugin-canvas-renderer/src/shapes/styles/Polyline.ts","../src/packages/g-plugin-canvas-renderer/src/shapes/styles/Polygon.ts","../src/packages/g-plugin-canvas-renderer/src/shapes/styles/Path.ts","../src/packages/g-plugin-canvas-renderer/src/index.ts"],"sourcesContent":[null,null,null,null,null,null,null,null,null,null,null,null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}